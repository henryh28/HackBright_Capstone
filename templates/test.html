{% extends 'base.html' %}

{% block title %} Chat test {% endblock %}

{% block head %} 
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>


<script type="text/javascript" charset="utf-8">
    var socket = io();
    socket.on('connect', function() {
        socket.emit('my event', {data: 'I\'m connected!'});
    });
</script>



<script type="text/javascript" charset="utf-8">
    $(document).ready(function() {

        var socket = io();

        socket.on('my_response', function(msg, cb) {
            alert("message : " + msg)
            $('#log').append('<br>' + $('<div/>').text('logs #' + msg.count + ': ' + msg.data).html());
            if (cb)
                cb();
        });

        socket.on('connect', function() {
            socket.emit('my_event', {data: 'connected to the SocketServer...'});
        });

        
        $('form#emit').submit(function(event) {
            socket.emit('my_event', {data: $('#emit_data').val()});
            return false;
        });
        $('form#broadcast').submit(function(event) {
            socket.emit('my_broadcast_event', {data: $('#broadcast_data').val()});
            return false;
        });
        $('form#disconnect').submit(function(event) {
            socket.emit('disconnect_request');
            return false;
        });
    });
</script>

{% endblock %}


{% block body %}


<h1> This is websocket client</h1>

<h1 style="background-color:white;">Socket</h1>
<form id="emit" method="POST" action='#'>
    <input type="text" name="emit_data" id="emit_data" placeholder="Message">
    <input type="submit" value="Send Message">
</form>
<form id="broadcast" method="POST" action='#'>
    <input type="text" name="broadcast_data" id="broadcast_data" placeholder="Message">
    <input type="submit" value="Send Broadcast Message">
</form>

<form id="disconnect" method="POST" action="#">
    <input type="submit" value="Disconnect Server">
</form>
<h2 style="background-color:white;">Logs</h2>
<div id="log" ></div>


{% endblock %}


